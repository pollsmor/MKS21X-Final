import java.util.Random;

public class Floor{
  private Block[][] blocksHere; //Array of Blocks (like patches)
  private int floorNumber;
  private int width;
  private int length;
  private Room[] roomsHere; //List of Rooms
  //private Mission[] missions; to be added later if we get to it

  //public Floor(int num, int terminal Width, int terminalLength)
  /** Constructs a Floor based on the terminal width and length and assigns the floor a number
    *@param num an int which will become the floorNumber
    *@param terminalWidth an int which will become the floor's width (used for creating blocksHere)
    *@param terminalLength an int which will become the floor's length (used for creating blocksHere)
  */
  public Floor(int num, int terminalWidth, int terminalLength){
    floorNumber = num;
    width = terminalWidth;
    length = terminalLength;
    blocksHere = new Block[width][length];
    for (int x = 0; x < width; x++){
      for (int y = 0; y < length; y++){
        blocksHere[x][y] = new Block(x, y, "Wall");
      }
    }
  }

  //public int getFloor()
  /**Returns the number of floors the Player has successfully passed
    *@return floorNumber: an int which represents the number of Floors played in the current Game
  */
  public int getFloorNumber(){
    return floorNumber;
  }

  public int getWidth(){
    return width;
  }
  public int getLength(){
    return length;
  }
  public void createRooms(int seed){
    Random rnd = new Random(seed); //Takes seed generated by Game class
    //First decide number of Rooms to create
    int rooms = rnd.nextInt(3) + (width * length)/20;
    roomsHere = new Room[rooms];
    System.out.println("Rooms: "+rooms);
    int attempts = 100; //In case it's impossible to create all the rooms, have a set number of failed attempts possible
    //Using random, generate the xcors and ycors of top right Blocks and bottom left Blocks of the Rooms
    //Minimum width of room: 4 | Max: 10
    //Minimum length of room: 4 | Max: 10
    int startXcor, startYcor, endXcor, endYcor;
    int successfulRooms = 0; //Keep track of how many Rooms were successfully made
    boolean wasOverlap; //Keep track of whether or Room to be created overlaps with any other Room
    while (successfulRooms < rooms && attempts > 0){
      startXcor = Math.abs(rnd.nextInt(width - 10));
      endXcor = startXcor + rnd.nextInt(6) + 4;
      startYcor = Math.abs(rnd.nextInt(length - 10));
      endYcor = startYcor + rnd.nextInt(6) + 4;
      //System.out.println("startXcor: "+ startXcor +", startYcor: "+startYcor+", endXcor: "+endXcor+", endYcor: "+endYcor);
      //In case either the endXcor or endYcor are >= width or length respectively, reduce them by the dimension as many times as it takes
      /*int holder;
      while (endXcor >= width){
        endXcor = endXcor-width;
        //In case the above makes starts > than ends, switch their values
        if (startXcor>endXcor){
          holder = startXcor;
          startXcor = endXcor;
          endXcor = holder;
        }
      }
      while (endYcor >= length){
        endYcor = endYcor-length;
        //In case the above makes starts > than ends, switch their values
        if (startYcor > endYcor){
          holder = startYcor;
          startYcor = endYcor;
          endYcor = holder;
        }
      }
      */
      wasOverlap = false;
      //Make sure that rooms don't overlap with each other
      //System.out.println("startXcor: "+ startXcor +", startYcor: "+startYcor+", endXcor: "+endXcor+", endYcor: "+endYcor);
      for (int i = 0; i < successfulRooms; i++){
        if (roomsHere[i].tooClose(startXcor, startYcor, endXcor, endYcor)){
          wasOverlap = true;
          i = roomsHere.length; //Stop loop once it has been discovered that a Room will overlap the new one
          attempts--; //Reduce attempts by 1
        }
      }
      if (!wasOverlap){ //If there were no overlapping Rooms, create the Room
        createRoom(startXcor, startYcor, endXcor, endYcor);
        roomsHere[successfulRooms]= createRoom(startXcor, startYcor, endXcor, endYcor);
        successfulRooms++;
      }
    }
  }

  public Room createRoom(int startXcor, int startYcor, int endXcor, int endYcor){
    Room a = new Room(startXcor, startYcor, endXcor, endYcor);
    //Must also update blocksHere
    for (int x = startXcor; x < endXcor; x++){
      for (int y = startYcor; y < endYcor; y++){
        this.blocksHere[x][y] = new Block(startXcor+x,startYcor+y,"Room");
      }
    }
    return a;
  }

  public String toString(){
    String output = "|";
    for (int y = 0; y < length; y++){
      output += "-";
    }
    output += "|\n";
    for (int x = 0; x < width; x++){
      output+="|";
      for (int y = 0; y < length; y++){
        output+= blocksHere[x][y].getData();
      }
      output+="|\n";
    }
    output +="|";
    for (int y = 0; y < length; y++){
      output += "-";
    }
    output += "|\n";
    return output+"End of Floor";
  }
}
